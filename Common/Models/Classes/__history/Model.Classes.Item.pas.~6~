unit Model.Classes.Item;

interface

uses
  System.JSON,
  FireDAC.Comp.DataSet,
  Interfaces.Model.Classes.Item;

  procedure AssignDataSetModelClassItem(const ADataSet: TFDDataSet);
  function CreateModelClassItem: IModelClassItem;
  function CreateFromJSONModelClassItem(const AJSONObject: TJSONObject): IModelClassItem;
  function CreateFromDataSetModelClassItem: IModelClassItem;

implementation

uses
  System.SysUtils,
  Model.Generator.GIDs,
  Model.Classes.BaseObject;

type
  ///<summary>Таблица - стоки/услуги</summary>
  TModelClassItem = class(TModelClassBaseObject, IModelClassItem)

  {$REGION 'Class Properties'}
  private class var

  public

  {$ENDREGION}


  {$REGION 'Private Methods'}
  private

  {$ENDREGION}


  {$REGION 'Private Fields'}
  private
    FShortName: String;
    FCode: String;
    FVendorPrice: String;
    FClientPrice: String;
    FBaseMeasure: String;
    FBaseCoeff: String;
    FBasePrice: String;
  {$ENDREGION}


  {$REGION 'Private Properties Getters/Setters'}
  private

  {$ENDREGION}


  {$REGION 'Private Properties'}
  private

  {$ENDREGION}


  {$REGION 'Interfaced Properties Getters/Setters'}
  public
    function GetShortName: String;
    procedure SetShortName(const AValue: String);
    function GetCode: String;
    procedure SetCode(const AValue: String);
    function GetVendorPrice: String;
    procedure SetVendorPrice(const AValue: String);
    function GetClientPrice: String;
    procedure SetClientPrice(const AValue: String);
    function GetBaseMeasure: String;
    procedure SetBaseMeasure(const AValue: String);
    function GetBaseCoeff: String;
    procedure SetBaseCoeff(const AValue: String);
    function GetBasePrice: String;
    procedure SetBasePrice(const AValue: String);
  {$ENDREGION}


  {$REGION 'Interfaced Properties'}
  public
    ///<summary>код в системата на стоката/услугата<summary>
//    property GID: String read GetGID write SetGID;
    ///<summary>наименование на вида стоката/услугата<summary>
//    property Name: String read GetName write SetName;
    ///<summary>кратко наименование на стоката/услугата<summary>
    property ShortName: String read GetShortName write SetShortName;
    ///<summary>вътрешен код на стоката/услугата<summary>
    property Code: String read GetCode write SetCode;
    ///<summary>ед.цена (доставна) на стоката/услугата<summary>
    property VendorPrice: String read GetVendorPrice write SetVendorPrice;
    ///<summary>ед.цена (продажна) на стоката/услугата<summary>
    property ClientPrice: String read GetClientPrice write SetClientPrice;
    ///<summary>базова мярка на стоката/услугата<summary>
    property BaseMeasure: String read GetBaseMeasure write SetBaseMeasure;
    ///<summary>базов коефициент на стоката/услугата<summary>
    property BaseCoeff: String read GetBaseCoeff write SetBaseCoeff;
    ///<summary>базова цена на стоката/услугата<summary>
    property BasePrice: String read GetBasePrice write SetBasePrice;
    ///<summary>дата и час на първоначално конфигуриране на стоката/услугата в системата<summary>
//    property AttachedAt: String read GetAttachedAt write SetAttachedAt;
    ///<summary>дата и час на последна промяна на стоката/услугата<summary>
//    property ModifiedAt: String read GetModifiedAt write SetModifiedAt;
    ///<summary>дата и час на извеждане на стоката/услугата от употреба<summary>
//    property DetachedAt: String read GetDetachedAt write SetDetachedAt;
  {$ENDREGION}


  {$REGION 'Interfaced Methods'}
  public
    procedure UpdateFromDataSet; override;
    procedure UpdateInDataSet; override;
    function ToJSON: TJSONObject; override;
  {$ENDREGION}


  {$REGION 'Constructors/Destructors'}
  public
    constructor Create;
    constructor CreateFromJSON(const AJSONObject: TJSONObject);
  {$ENDREGION}
  end;

{ TModelClassItem }

{$REGION 'Private Methods'}

{$ENDREGION}


{$REGION 'Private Properties Getters/Setters'}

{$ENDREGION}


{$REGION 'Interfaced Properties Getters/Setters'}

function TModelClassItem.GetShortName: String;
begin
  Result := FShortName;
end;

procedure TModelClassItem.SetShortName(const AValue: String);
begin
  FShortName := AValue;
end;

function TModelClassItem.GetCode: String;
begin
  Result := FCode;
end;

procedure TModelClassItem.SetCode(const AValue: String);
begin
  FCode := AValue;
end;

function TModelClassItem.GetVendorPrice: String;
begin
  Result := FVendorPrice;
end;

procedure TModelClassItem.SetVendorPrice(const AValue: String);
begin
  FVendorPrice := AValue;
end;

function TModelClassItem.GetClientPrice: String;
begin
  Result := FClientPrice;
end;

procedure TModelClassItem.SetClientPrice(const AValue: String);
begin
  FClientPrice := AValue;
end;

function TModelClassItem.GetBaseMeasure: String;
begin
  Result := FBaseMeasure;
end;

procedure TModelClassItem.SetBaseMeasure(const AValue: String);
begin
  FBaseMeasure := AValue;
end;

function TModelClassItem.GetBaseCoeff: String;
begin
  Result := FBaseCoeff;
end;

procedure TModelClassItem.SetBaseCoeff(const AValue: String);
begin
  FBaseCoeff := AValue;
end;

function TModelClassItem.GetBasePrice: String;
begin
  Result := FBasePrice;
end;

procedure TModelClassItem.SetBasePrice(const AValue: String);
begin
  FBasePrice := AValue;
end;

{$ENDREGION}


{$REGION 'Interfaced Methods'}

procedure TModelClassItem.UpdateFromDataSet;
begin
  GID := DataSet.FieldByName('GID').Value;
  Name := DataSet.FieldByName('Name').Value;
  ShortName := DataSet.FieldByName('ShortName').Value;
  Code := DataSet.FieldByName('Code').Value;
  VendorPrice := DataSet.FieldByName('VendorPrice').Value;
  ClientPrice := DataSet.FieldByName('ClientPrice').Value;
  BaseMeasure := DataSet.FieldByName('BaseMeasure').Value;
  BaseCoeff := DataSet.FieldByName('BaseCoeff').Value;
  BasePrice := DataSet.FieldByName('BasePrice').Value;
  AttachedAt := DataSet.FieldByName('AttachedAt').Value;
  ModifiedAt := DataSet.FieldByName('ModifiedAt').Value;
  DetachedAt := DataSet.FieldByName('DetachedAt').Value;
end;

procedure TModelClassItem.UpdateInDataSet;
begin
  inherited UpdateInDataSet;

  DataSet.Edit;
  DataSet.FieldByName('ShortName').Value := ShortName;
  DataSet.FieldByName('Code').Value := Code;
  DataSet.FieldByName('VendorPrice').Value := VendorPrice;
  DataSet.FieldByName('ClientPrice').Value := ClientPrice;
  DataSet.FieldByName('BaseMeasure').Value := BaseMeasure;
  DataSet.FieldByName('BaseCoeff').Value := BaseCoeff;
  DataSet.FieldByName('BasePrice').Value := BasePrice;
  DataSet.Post;
end;

function TModelClassItem.ToJSON: TJSONObject;
begin
  Result := inherited ToJSON;
  Result.AddPair('ShortName', ShortName);
  Result.AddPair('Code', Code);
  Result.AddPair('VendorPrice', VendorPrice);
  Result.AddPair('ClientPrice', ClientPrice);
  Result.AddPair('BaseMeasure', BaseMeasure);
  Result.AddPair('BaseCoeff', BaseCoeff);
  Result.AddPair('BasePrice', BasePrice);
end;

{$ENDREGION}


{$REGION 'Constructors/Destructors'}

constructor TModelClassItem.Create;
begin
  inherited Create;
  GID := TGeneratorGIDs.NewGIDByName('ItemGID').ToString;
end;

constructor TModelClassItem.CreateFromJSON(const AJSONObject: TJSONObject);
begin
  inherited CreateFromJSON(AJSONObject);
  ShortName := (AJSONObject.GetValue('ShortName') as TJSONString).Value;
  Code := (AJSONObject.GetValue('Code') as TJSONString).Value;
  VendorPrice := (AJSONObject.GetValue('VendorPrice') as TJSONString).Value;
  ClientPrice := (AJSONObject.GetValue('ClientPrice') as TJSONString).Value;
  BaseMeasure := (AJSONObject.GetValue('BaseMeasure') as TJSONString).Value;
  BaseCoeff := (AJSONObject.GetValue('BaseCoeff') as TJSONString).Value;
  BasePrice := (AJSONObject.GetValue('BasePrice') as TJSONString).Value;
end;

{$ENDREGION}

procedure AssignDataSetModelClassItem(const ADataSet: TFDDataSet);
begin
  TModelClassItem.AssignDataSet(ADataSet);
end;

function CreateModelClassItem: IModelClassItem;
begin
  Result := TModelClassItem.Create;
end;

function CreateFromJSONModelClassItem(const AJSONObject: TJSONObject): IModelClassItem;
begin
  Result := TModelClassItem.CreateFromJSON(AJSONObject);
end;

function CreateFromDataSetModelClassItem: IModelClassItem;
begin
  Result := TModelClassItem.CreateFromDataSet;
end;

end.
