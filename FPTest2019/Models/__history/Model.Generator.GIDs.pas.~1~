unit Model.Generator.GIDs;

interface

type
  TModelGeneratorGIDs = class

  {$REGION 'Private Methods'}
  private

  {$ENDREGION}

  {$REGION 'Private Fields'}
  private
    class var
      FGlobalGID: Integer;
  {$ENDREGION}

  {$REGION 'Private Properties Getters/Setters'}
  private
    class function GetGlobalGID: Integer; static;
    class procedure SetGlobalGID(const Value: Integer); static;
  {$ENDREGION}

  {$REGION 'Private Properties'}
  private
    class property GlobalGID: Integer read GetGlobalGID write SetGlobalGID;
  {$ENDREGION}

  {$REGION 'Interfaced Properties Getters/Setters'}
  public

  {$ENDREGION}

  {$REGION 'Interfaced Properties'}
  public
    class function NewGIDByName(const AName: String; const AInitValue: Integer = 0): Integer;
  {$ENDREGION}

  {$REGION 'Interfaced Methods'}
  public

  {$ENDREGION}

  {$REGION 'Constructors/Destructors'}
  public
    class constructor Create;
  {$ENDREGION}
  end;

implementation

{ TModelGeneratorGIDs }

uses
  System.SysUtils,
  Model.Settings;

{$REGION 'Private Methods'}

{$ENDREGION}

{$REGION 'Private Properties Getters/Setters'}

class function TModelGeneratorGIDs.GetGlobalGID: Integer;
begin
  Result := FGlobalGID;
end;

class procedure TModelGeneratorGIDs.SetGlobalGID(const Value: Integer);
begin
  FGlobalGID := Value;
end;

{$ENDREGION}

{$REGION 'Interfaced Properties Getters/Setters'}

{$ENDREGION}

{$REGION 'Interfaced Methods'}

class function TModelGeneratorGIDs.NewGIDByName(const AName: String; const AInitValue: Integer = 0): Integer;
var
  LIDString: String;
  LID: Integer;
begin
  Result := AInitValue;
  LIDString := TModelSettings.GetSetting('IDs', AName);
  if TryStrToInt(LIDString, LID) then begin
    Result := GlobalGID * 256*256*256 + LID;
  end;
  TModelSettings.SetSetting('IDs', AName, IntToStr(LID + 1));
end;

{$ENDREGION}

{$REGION 'Constructors/Destructors'}

class constructor TModelGeneratorGIDs.Create;
var
  LGlobalGID: String;
begin
  Randomize;
  LGlobalGID := TModelSettings.GetSetting('IDs', 'GlobalGID', Random(127).ToString);
  GlobalGID := LGlobalGID.ToInteger;
end;

{$ENDREGION}

end.

