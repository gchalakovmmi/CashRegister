unit ViewModel.CheckItem;

interface

uses
  Interfaces.ViewModel.CheckItem;

  function CreateViewModelCheckItem: IViewModelCheckItem;

implementation

uses
  Winapi.Windows,
  System.SysUtils,
  System.Classes,
  Vcl.ExtCtrls,
  Globals,
  Interfaces.Enums,
  Interfaces.GUIRecords,
  Interfaces.Model.Pattern.Observer,
  Interfaces.Model.Notification,
  Model.Pattern.Observer.Observer,
  Model.Pattern.Observer.Observable,
  Model.Notification,

  Interfaces.Model.CheckItem,
  DataModule.Items,
  Model.CheckItem,
  View.SelectItem;

type
  TViewModelCheckItem = class(TInterfacedObject, IViewModelCheckItem, IObservable)

  {$REGION 'Private Methods'}
  private
    procedure OnTimer(Sender: TObject);
    procedure SendNotification(const AInterfaceActions: TInterfaceActions);
  {$ENDREGION}

  {$REGION 'Private Fields'}
  private
    FModel: IModelCheckItem;
    FObservable: IObservable;
  {$ENDREGION}

  {$REGION 'Private Properties Getters/Setters'}
  private

  {$ENDREGION}

  {$REGION 'Private Properties'}
  private

  {$ENDREGION}

  {$REGION 'Interfaced Properties Getters/Setters'}
  public
    function GetObservable: IObservable;
    function GetModel: IModelCheckItem;
    procedure SetModel(const Value: IModelCheckItem);
  {$ENDREGION}

  {$REGION 'Interfaced Properties'}
  public
    property Observable: IObservable read GetObservable implements IObservable;
    property Model: IModelCheckItem read GetModel write SetModel;
  {$ENDREGION}

  {$REGION 'Interfaced Methods'}
  public
    function GetGUIRecord: TViewCheckItemGUIRecord;
    procedure KeyPressed(Key: Char);
  {$ENDREGION}

  {$REGION 'Constructors/Destructors'}
  public
    constructor Create;
    destructor Destroy; override;
  {$ENDREGION}
  end;

function CreateViewModelCheckItem: IViewModelCheckItem;
begin
  Result := TViewModelCheckItem.Create;
end;

{ TViewModelCheckItem }

{$REGION 'Private Methods'}

procedure TViewModelCheckItem.SendNotification(const AInterfaceActions: TInterfaceActions);
var
  LModelNotification: IModelNotification;
begin
  if Assigned(FObservable) then begin
    LModelNotification := CreateNotificationClass;
    LModelNotification.Actions := AInterfaceActions;
    FObservable.NotifyObservers(LModelNotification);
  end;
end;

{$ENDREGION}


{$REGION 'Private Properties Getters/Setters'}

{$ENDREGION}


{$REGION 'Interfaced Properties Getters/Setters'}

function TViewModelCheckItem.GetObservable: IObservable;
begin
  Result := FObservable;
end;

function TViewModelCheckItem.GetModel: IModelCheckItem;
begin
  Result := FModel;
end;

procedure TViewModelCheckItem.SetModel(const Value: IModelCheckItem);
begin
  FModel := Value;
end;

{$ENDREGION}


{$REGION 'Interfaced Methods'}

function TViewModelCheckItem.GetGUIRecord: TViewCheckItemGUIRecord;
begin
  Result.LabelCodeCaption := DataModuleItems.SelectedCODE;
  Result.LabelItemCaption := DataModuleItems.SelectedNAME;
  Result.LabelMeasureCaption := DataModuleItems.SelectedMEASURE;
  Result.LabelPriceCaption := DataModuleItems.SelectedCLIENTPRICE;
end;

procedure TViewModelCheckItem.KeyPressed(Key: Char);
begin
  if Key = #27 then begin
    SendNotification([actCloseForm]);
  end else begin
    SelectItem(Key);
    SendNotification([actUpdateGUI]);
  end;
end;

{$ENDREGION}


{$REGION 'Constructors/Destructors'}

constructor TViewModelCheckItem.Create;
begin
  inherited;
  FObservable := CreateObservableClass;
  FModel := CreateModelCheckItem;
end;

destructor TViewModelCheckItem.Destroy;
begin
  //
  inherited;
end;

{$ENDREGION}

end.
